---
- hosts: sclab
  remote_user: stevenokm
  become: yes
  become_user: root
  become_method: sudo
  tasks:
    - name: python3
      block:
      - name: install python3
        apt:
          pkg:
          - python3
          - python3-dev
          state: present
          update_cache: yes
      - name: install libpython3
        apt:
          pkg:
          - libpython3.6
          - libpython3.6-dev
          state: present
          update_cache: yes
      - name: install python3-pip
        apt:
          pkg: python3-pip
          state: present
          update_cache: yes
      - name: upgrade latest pip3
        shell: python3 -m pip install pip --upgrade --force
      - name: check installed packages
        package_facts:
          manager: auto
      - name: glances part
        block:
        - name: install latest glances in python3
          pip:
            name: glances
            state: latest
            executable: pip3
        - name: install latest nvidia-ml-py3 in python3
          pip:
            name: nvidia-ml-py3
            state: latest
            executable: pip3
        - name: install latest py3nvml in python3
          pip:
            name: py3nvml
            state: latest
            executable: pip3
        - name: install llvm-8
          apt:
            pkg:
            - llvm-8
            - libllvm8
            state: present
            update_cache: yes
        - name: install latest llvmlite in python3
          pip:
            name: llvmlite
            state: latest
            executable: pip3
          environment:
            LLVM_CONFIG=llvm-config-8
        - name: install latest netifaces in python3
          pip:
            name: netifaces
            state: latest
            executable: pip3
        - name: install latest py-cpuinfo in python3
          pip:
            name: py-cpuinfo
            state: latest
            executable: pip3
        - name: install latest pySMART.smartx in python3
          pip:
            name: pySMART.smartx
            state: latest
            executable: pip3
        - name: install latest docker-py in python3
          pip:
            name: docker
            state: latest
            executable: pip3
          when: ansible_facts.packages['docker-ce'] is defined
        - name: install hddtemp
          apt:
            pkg: hddtemp
            state: present
            update_cache: yes
        - name: setup config file for glances
          copy:
            src: "glances.conf"
            dest: "/etc/glances/"
      - name: install latest kaggle in python3
        pip:
          name: kaggle
          executable: pip3
      - name: install matplotlib in python3
        pip:
          name: matplotlib
          executable: pip3
      - name: install jupyter in python3
        pip:
          name: jupyter
          executable: pip3
          state: forcereinstall
      - name: install pytorch 1.6.0 and torchvision 0.7.0
        pip:
          name:
          - torch==1.6.0
          - torchvision==0.7.0
          executable: pip3
      - name: install tensorflow 2.3.2
        pip:
          name:
          - tensorflow==2.3.2
          - tensorflow-text==2.3.0
          executable: pip3
      - name: set jupyter notebook ip setting script
        copy:
          dest: "/etc/profile.d/00-jupyter-alias.sh"
          content: |
            alias jupyter-notebook='jupyter-notebook --ip `hostname -i` --no-browser'
      when: ansible_distribution == 'Ubuntu' and ansible_distribution_version == "18.04"
